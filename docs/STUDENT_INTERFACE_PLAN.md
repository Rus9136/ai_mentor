# План реализации студенческого интерфейса AI Mentor

**Версия:** 1.4 | **Дата:** 2025-12-18 | **Статус:** В разработке (Этапы 1-4 завершены)

---

## Обзор

Студенческий интерфейс — веб-приложение для школьников 7-11 классов, где основной фокус на поэтапном освоении материала, а не пассивном чтении.

**Ключевые принципы (из анализа Google Learn Your Way):**
- Микро-порции контента (2-7 минут на блок)
- Активное обучение через встроенные вопросы
- Мультиформатность (текст → карточки → видео → практика)
- Прогресс как путь, а не проценты
- Поддерживающая обратная связь

**Production URL:** https://ai-mentor.kz

---

## Дизайн-система

Дизайн вдохновлён **Google Learn Your Way** — теплый, дружелюбный, mobile-first.

### Цветовая палитра

| Название | HEX | HSL | Использование |
|----------|-----|-----|---------------|
| **Primary (Orange)** | `#E88134` | `hsl(25, 80%, 55%)` | Кнопки, акценты, категории, CTA |
| **Success (Green)** | `#9FC969` | `hsl(88, 46%, 60%)` | Прогресс, успех, завершение |
| **Dark (Brown)** | `#522E21` | `hsl(15, 43%, 23%)` | Основной текст, заголовки |
| **Background (Cream)** | `#FAF6F1` | `hsl(30, 45%, 96%)` | Фон страниц |
| **Card (White)** | `#FFFFFF` | `hsl(0, 0%, 100%)` | Карточки, модальные окна |
| **Muted** | — | `hsl(30, 20%, 90%)` | Неактивные элементы, borders |

### Типографика

**Шрифт: Nunito** (Google Fonts)
- Округлый, дружелюбный шрифт
- Отлично читается на мобильных устройствах
- Подходит для школьной аудитории

```css
/* Подключение в Next.js */
import { Nunito } from 'next/font/google';

const nunito = Nunito({
  subsets: ['latin', 'cyrillic'],
  weight: ['400', '500', '600', '700', '800'],
  variable: '--font-nunito',
});
```

**Размеры текста:**
- Заголовок страницы: `text-2xl md:text-3xl font-bold`
- Заголовок секции: `text-lg font-bold`
- Заголовок карточки: `font-bold` (базовый размер)
- Основной текст: базовый размер
- Подписи: `text-sm text-muted-foreground`
- Мелкий текст: `text-xs`

### UI компоненты

**Карточки:**
```css
/* Приподнятая карточка с тенью */
.card-elevated {
  @apply bg-card rounded-2xl shadow-lg shadow-black/5;
}

/* Плоская карточка с границей */
.card-flat {
  @apply bg-card rounded-2xl border border-border;
}
```

**Кнопки (pill-style):**
```css
.btn-pill {
  @apply rounded-full px-6 py-3 font-semibold transition-all;
}

.btn-primary {
  @apply bg-primary text-primary-foreground hover:opacity-90 active:scale-[0.98];
}

.btn-secondary {
  @apply bg-secondary text-secondary-foreground hover:bg-secondary/80;
}
```

**Декоративные blob-формы:**
```css
.blob {
  border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%;
  position: absolute;
  pointer-events: none;
}

.blob-orange {
  background: linear-gradient(135deg, hsl(25, 80%, 75%) 0%, hsl(25, 80%, 65%) 100%);
}

.blob-green {
  background: linear-gradient(135deg, hsl(88, 46%, 70%) 0%, hsl(88, 46%, 60%) 100%);
}

/* Анимация морфинга */
.blob-animate {
  animation: blob-morph 8s ease-in-out infinite;
}
```

**Прогресс-бары:**
```css
.progress-segment {
  @apply h-2 rounded-full transition-all duration-300;
}

.progress-segment-active {
  @apply bg-primary;
}

.progress-segment-completed {
  @apply bg-success;
}
```

### Принципы дизайна

1. **Mobile-first** — все страницы сначала разрабатываются для мобильных устройств
2. **Много воздуха** — достаточно padding и margin между элементами
3. **Скругленные углы** — `rounded-2xl` для карточек, `rounded-full` для кнопок
4. **Мягкие тени** — `shadow-soft` вместо резких теней
5. **Теплые цвета** — кремовый фон, оранжевые акценты
6. **Дружелюбные иконки** — Lucide React, размер 4-5 для UI, 10+ для hero-элементов
7. **Эмодзи для предметов** — 📜 История, 📐 Алгебра, ⚡ Физика, 🧬 Биология

### Файлы дизайн-системы

```
student-app/
├── src/app/globals.css           # CSS переменные, blob-классы, компоненты
├── tailwind.config.ts            # Цвета, шрифты, тени, радиусы
└── src/app/[locale]/layout.tsx   # Подключение Nunito
```

---

## Часть 1. MVP (Minimum Viable Product)

### Цель MVP
Запустить базовый учебный процесс, где ученик может:
1. Войти в систему и видеть свои предметы
2. Изучать параграф поэтапно (Введение → Объяснение → Практика → Итог)
3. Видеть свой прогресс
4. Получать обратную связь после практики

### Технический стек MVP
```
Frontend: Next.js 15 + TypeScript + Tailwind CSS + shadcn/ui
State:    TanStack Query (уже используется в admin-v2)
Auth:     JWT (интеграция с существующим backend)
Deploy:   Docker + Nginx (ai-mentor.kz)
```

### Структура проекта
```
student-app/
├── src/
│   ├── app/
│   │   ├── [locale]/
│   │   │   ├── (auth)/
│   │   │   │   └── login/page.tsx
│   │   │   └── (learning)/
│   │   │       ├── layout.tsx              # Bottom nav + header
│   │   │       ├── page.tsx                # Главная (dashboard)
│   │   │       ├── subjects/
│   │   │       │   └── [id]/page.tsx       # Предмет → главы
│   │   │       ├── chapters/
│   │   │       │   └── [id]/page.tsx       # Глава → параграфы
│   │   │       ├── paragraphs/
│   │   │       │   └── [id]/
│   │   │       │       ├── page.tsx        # Обзор параграфа
│   │   │       │       └── learn/page.tsx  # Процесс изучения
│   │   │       ├── practice/
│   │   │       │   └── [attemptId]/page.tsx # Практика/тест
│   │   │       └── profile/page.tsx        # Профиль + статистика
│   │   └── layout.tsx
│   ├── components/
│   │   ├── ui/                             # shadcn/ui
│   │   ├── learning/
│   │   │   ├── step-indicator.tsx          # Прогресс по этапам
│   │   │   ├── content-block.tsx           # Блок контента
│   │   │   ├── embedded-question.tsx       # Встроенный вопрос
│   │   │   ├── progress-path.tsx           # Визуальный путь
│   │   │   └── completion-screen.tsx       # Экран завершения
│   │   ├── practice/
│   │   │   ├── question-card.tsx           # Карточка вопроса
│   │   │   ├── answer-feedback.tsx         # Обратная связь
│   │   │   └── practice-result.tsx         # Результат практики
│   │   └── navigation/
│   │       ├── bottom-nav.tsx              # Мобильная навигация
│   │       └── subject-card.tsx            # Карточка предмета
│   ├── lib/
│   │   ├── api/
│   │   │   ├── client.ts                   # Axios instance
│   │   │   ├── auth.ts
│   │   │   ├── textbooks.ts
│   │   │   ├── paragraphs.ts
│   │   │   └── tests.ts
│   │   └── hooks/
│   │       ├── use-auth.ts
│   │       ├── use-textbooks.ts
│   │       ├── use-paragraph-content.ts
│   │       └── use-practice.ts
│   └── stores/
│       └── learning-progress.ts            # Zustand store
├── public/
├── next.config.js
├── tailwind.config.js
└── Dockerfile
```

---

## MVP: Этапы реализации

### Этап 1: Базовая инфраструктура ✅ ЗАВЕРШЁН

**1.1 Инициализация проекта** ✅
```bash
Задачи:
├── [x] Создать Next.js 16 проект с App Router
├── [x] Настроить TypeScript, Tailwind CSS, shadcn/ui
├── [x] Настроить next-intl (ru/kk)
├── [x] Настроить TanStack Query
├── [x] Создать Dockerfile и docker-compose
└── [x] Настроить CI/CD для деплоя на ai-mentor.kz
```

**1.2 Аутентификация** ✅
```bash
Задачи:
├── [x] Страница логина (Google OAuth вместо email/password)
├── [x] JWT middleware (access + refresh tokens)
├── [x] AuthGuard компонент (AuthProvider)
├── [x] Хранение токенов (localStorage + axios interceptors)
├── [x] Redirect на логин при 401
├── [x] Onboarding с кодом приглашения школы
└── [x] Возможность продолжить без школы (индивидуальный ученик)
```

**1.3 Базовый layout** ✅
```bash
Задачи:
├── [x] Header с аватаром и кнопкой выхода (desktop)
├── [x] Bottom navigation (mobile-first):
│       [Главная] [Предметы] [Профиль]
├── [x] Responsive layout (mobile → desktop)
├── [x] Дизайн-система Google Learn Your Way
└── [ ] Темная/светлая тема (отложено)
```

**Результат этапа 1:** ✅
- ✅ Работающее приложение с Google OAuth авторизацией
- ✅ Базовый layout для всех страниц
- ✅ Деплой на production (https://ai-mentor.kz)

---

### Этап 2: Главная страница и навигация ✅ ЗАВЕРШЁН

**2.1 Главная страница (Dashboard)** ✅
```
┌─────────────────────────────────────────┐
│  Доброе утро, [Имя]! 👋                 │
│  Продолжай учиться и достигай целей     │
│                                         │
│  ┌───────────────────────────────────┐  │
│  │ ▶ ПРОДОЛЖИТЬ ОБУЧЕНИЕ             │  │
│  │ §3.2 Образование Казахского ханства │ │
│  │ История Казахстана → Глава 3      │  │
│  │ ░░░░████░░░░░░░░░░ 45%            │  │
│  └───────────────────────────────────┘  │
│                                         │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐   │
│  │ 🔥 5    │ │ ✓ 12   │ │ 🏆 48   │   │
│  │дней подр│ │параграф │ │ задач   │   │
│  └─────────┘ └─────────┘ └─────────┘   │
│                                         │
│  📚 МОИ ПРЕДМЕТЫ                        │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐   │
│  │📜 35%   │ │📐 60%   │ │⚡ 15%   │   │
│  │История  │ │Алгебра  │ │ Физика  │   │
│  │3/8 глав │ │6/10 глав│ │2/12 глав│   │
│  └─────────┘ └─────────┘ └─────────┘   │
└─────────────────────────────────────────┘
```

```bash
Задачи:
├── [x] Приветствие с именем (утро/день/вечер)
├── [x] Компонент SubjectCard с эмодзи, прогрессом, цветом
├── [x] Блок "Продолжить обучение"
├── [x] Мини-статистика: streak, параграфы, задачи
├── [x] API: GET /students/textbooks ✅
├── [x] Frontend интеграция с API (TanStack Query)
├── [x] Loading/error состояния
└── [x] Mastery level badges (A/B/C)
```

**2.2 Страница предмета (учебника)** ✅
```
┌─────────────────────────────────────────┐
│  ← Алгебра 7 класс                      │
│                                         │
│  ГЛАВЫ:                                 │
│                                         │
│  ● Глава 1: Числа         [✓ Пройдено] │
│  ● Глава 2: Выражения     [В процессе] │
│  ○ Глава 3: Уравнения     [Заблокир.]  │
│  ○ Глава 4: Функции       [Заблокир.]  │
│                                         │
└─────────────────────────────────────────┘
```

```bash
Задачи:
├── [x] Список глав с прогрессом
├── [x] Состояния: пройдено / в процессе / заблокировано / не начато
├── [x] Mastery level badges (A/B/C)
├── [x] Индикатор теста по главе
├── [x] API: GET /students/textbooks/{id}/chapters ✅
└── [x] Frontend: /subjects/[id] страница
```

**2.3 Страница главы** ✅
```
┌─────────────────────────────────────────┐
│  ← Глава 2: Алгебраические выражения    │
│                                         │
│  ПАРАГРАФЫ:                             │
│                                         │
│  §2.1 Понятие выражения    [✓] 5 мин   │
│  §2.2 Преобразования       [◐] 7 мин   │
│  §2.3 Тождества            [○] 6 мин   │
│                                         │
│  ────────────────────────────────────── │
│  📝 ТЕСТ ПО ГЛАВЕ          [Недоступен]│
│  Пройди все параграфы, чтобы открыть   │
└─────────────────────────────────────────┘
```

```bash
Задачи:
├── [x] Список параграфов с состояниями
├── [x] Примерное время на параграф
├── [x] Индикатор практики с результатом
├── [x] Кнопка "Продолжить/Начать изучение"
├── [x] API: GET /students/chapters/{id}/paragraphs ✅
└── [x] Frontend: /chapters/[id] страница
```

**Результат этапа 2:** ✅
- ✅ Навигация: Главная → Предмет → Глава → Параграф
- ✅ Визуальный прогресс на каждом уровне
- ✅ Mobile-first дизайн
- ✅ TanStack Query интеграция
- ✅ Локализация (ru/kk)

---

### Этап 3: Изучение параграфа ✅ ЗАВЕРШЁН

**3.1 Обзор параграфа** ✅
```
┌─────────────────────────────────────────┐
│  ← §2.2 Преобразование выражений        │
│                                         │
│  Что ты изучишь:                        │
│  • Как упрощать выражения               │
│  • Как раскрывать скобки                │
│  • Как приводить подобные               │
│                                         │
│  ⏱ Примерное время: ~12 минут          │
│                                         │
│  ТВОЙ ПУТЬ:                             │
│  ● Введение         2 мин   [✓]        │
│  ● Объяснение       5 мин   [◐]        │
│  ○ Примеры          3 мин   [○]        │
│  ○ Практика         5 мин   [🔒]       │
│  ○ Итог             1 мин   [🔒]       │
│                                         │
│  [Продолжить: Объяснение →]             │
└─────────────────────────────────────────┘
```

```bash
Задачи:
├── [x] Компонент StepIndicator (этапы параграфа) ✅
├── [x] Расчёт времени на этап (из metadata или estimation) ✅
├── [x] Логика разблокировки этапов ✅
├── [x] API: GET /students/paragraphs/{id} ✅ ГОТОВ (с rich content флагами)
├── [x] API: GET /students/paragraphs/{id}/content ✅ ГОТОВ (аудио, видео, карточки)
├── [x] API: GET /students/paragraphs/{id}/navigation ✅ ГОТОВ (prev/next)
└── [x] Хранение прогресса в БД через API ✅
```

**3.2 Экран изучения (Learning Flow)** ✅
```
┌─────────────────────────────────────────┐
│  §2.2 → Объяснение            [2/4]    │
│  ░░░░████░░░░░░░░░░░░░░░░░░░░░░ 25%    │
│─────────────────────────────────────────│
│                                         │
│  КАК РАСКРЫВАТЬ СКОБКИ                  │
│                                         │
│  Если перед скобками стоит "+":         │
│  знаки внутри не меняются.              │
│                                         │
│  +(a - b + c) = a - b + c               │
│                                         │
│  [Интерактивная визуализация]           │
│                                         │
│─────────────────────────────────────────│
│  💭 ПРОВЕРЬ СЕБЯ                        │
│                                         │
│  Раскрой скобки: +(3x - 2)              │
│  [ ] -3x + 2                            │
│  [●] 3x - 2                             │
│  [ ] 3x + 2                             │
│                                         │
│─────────────────────────────────────────│
│  [← Назад]              [Далее →]       │
└─────────────────────────────────────────┘
```

```bash
Задачи:
├── [x] Компонент ContentBlock (отображение explain_text) ✅
├── [x] Компонент EmbeddedQuestion (вопрос внутри контента) ✅
├── [x] Поддержка LaTeX (KaTeX) ✅
├── [x] Разбиение на табы (текст/аудио/карточки) ✅
├── [x] Прогресс-бар внутри этапа (StepIndicator) ✅
├── [x] Навигация назад/вперёд ✅
└── [x] Сохранение прогресса через API ✅
```

**3.3 Поддержка Rich Content** ✅
```bash
Задачи:
├── [x] Отображение explain_text (основной текст) ✅
├── [x] Аудио-плеер для explain_audio_url ✅
├── [x] Видео-плеер для video_urls ✅
├── [x] Слайдер для slides (JSON → карусель) ✅
├── [x] Карточки для cards (JSON → flashcards) ✅
└── [x] Переключатель языка RU/KK (через locale) ✅
```

**3.4 Самооценка после этапа** ✅
```
┌─────────────────────────────────────────┐
│  Ты прошёл: Объяснение                  │
│                                         │
│  Как тебе материал?                     │
│                                         │
│  [Всё понятно ✓] [Вопросы ?] [Сложно ✗]│
│                                         │
└─────────────────────────────────────────┘
```

```bash
Задачи:
├── [x] Компонент SelfAssessment ✅
├── [x] Три варианта оценки: understood / questions / difficult ✅
├── [x] API: POST /students/paragraphs/{id}/self-assessment ✅
└── [x] Сохранение оценки в БД (student_paragraphs.self_assessment) ✅
```

**Результат этапа 3:** ✅
- ✅ Полный flow изучения параграфа
- ✅ Отображение Rich Content (текст, аудио, видео, карточки)
- ✅ Встроенные вопросы для активного обучения
- ✅ Самооценка после каждого этапа

---

### Этап 4: Практика и тестирование ✅ ЗАВЕРШЁН

**4.1 Экран практики (Embedded Questions)** ✅
```
┌─────────────────────────────────────────┐
│  §2.2 → Практика              2 из 5   │
│  ○ ● ○ ○ ○                              │
│─────────────────────────────────────────│
│                                         │
│  УПРОСТИ ВЫРАЖЕНИЕ:                     │
│                                         │
│  3(x + 2) - 2(x - 1)                   │
│                                         │
│  Твой ответ:                            │
│  [________________]                     │
│                                         │
│  [Проверить ✓]                          │
│                                         │
│─────────────────────────────────────────│
│  💡 Нужна помощь?                       │
│  [Подсказка] [Разбор похожей задачи]   │
└─────────────────────────────────────────┘
```

```bash
Задачи:
├── [x] Компонент EmbeddedQuestion для типов: ✅
│       • SINGLE_CHOICE ✅
│       • MULTIPLE_CHOICE ✅
│       • TRUE_FALSE ✅
├── [x] Компонент AnswerFeedback (правильно/неправильно) ✅
├── [x] Система подсказок (hints из question.hint) ✅
├── [x] API: GET /students/paragraphs/{id}/embedded-questions ✅
├── [x] API: POST /students/embedded-questions/{id}/answer ✅
└── [ ] Адаптивная сложность по группе A/B/C (отложено)
```

**4.2 Обратная связь после ответа** ✅
```
Правильный ответ:
┌─────────────────────────────────────────┐
│  ✓ Верно!                               │
│                                         │
│  3(x+2) - 2(x-1) = 3x + 6 - 2x + 2     │
│                   = x + 8               │
│                                         │
│  [Далее →]                              │
└─────────────────────────────────────────┘

Неправильный ответ:
┌─────────────────────────────────────────┐
│  Почти! Давай разберём.                 │
│                                         │
│  Твой ответ: x + 4                      │
│  Правильный: x + 8                      │
│                                         │
│  Ошибка в раскрытии второй скобки:      │
│  -2(x - 1) = -2x + 2, а не -2x - 2     │
│                                         │
│  [Понятно, далее →]                     │
└─────────────────────────────────────────┘
```

```bash
Задачи:
├── [x] Компонент AnswerFeedback с объяснением ✅
├── [x] Отображение правильного ответа ✅
├── [x] Объяснение ошибки (из question.explanation) ✅
└── [x] Кнопка "Показать подсказку" ✅
```

**Результат этапа 4:** ✅
- ✅ Прохождение embedded questions с обратной связью
- ✅ Поддержка 3 типов вопросов (single/multiple choice, true/false)
- ✅ Система подсказок

---

### Этап 5: Завершение и прогресс (2-3 дня)

**5.1 Экран завершения параграфа**
```
┌─────────────────────────────────────────┐
│  §2.2 Преобразование выражений          │
│  ЗАВЕРШЕНО! 🎉                          │
│─────────────────────────────────────────│
│                                         │
│  📊 ТВОЙ РЕЗУЛЬТАТ                      │
│                                         │
│  Практика: 4/5 (80%)                    │
│  Время: 14 минут                        │
│  Уровень: Группа B                      │
│                                         │
│─────────────────────────────────────────│
│  📝 ЧТО ТЫ УЗНАЛ                        │
│                                         │
│  • Как раскрывать скобки                │
│  • Как приводить подобные слагаемые     │
│  • Как проверять результат              │
│                                         │
│─────────────────────────────────────────│
│  ЧТО ДАЛЬШЕ?                            │
│                                         │
│  [▶ §2.3 Тождества]                     │
│  [↺ Повторить задачу 3]                 │
│  [📚 К списку глав]                     │
└─────────────────────────────────────────┘
```

```bash
Задачи:
├── [ ] Компонент CompletionScreen
├── [ ] Расчёт и отображение результата
├── [ ] Отображение группы mastery (A/B/C)
├── [ ] Список ключевых выводов (из content.cards или hardcode)
├── [ ] Навигация к следующему параграфу
├── [ ] API: обновление student_paragraphs
└── [ ] API: GET /students/mastery/chapter/{id} (уже есть)
```

**5.2 Страница профиля со статистикой**
```
┌─────────────────────────────────────────┐
│  ПРОФИЛЬ                                │
│                                         │
│  [Аватар]  Алихан Султанов              │
│            7-А класс                    │
│            Школа №1                     │
│                                         │
│─────────────────────────────────────────│
│  📊 МОЯ СТАТИСТИКА                      │
│                                         │
│  Дней подряд:        🔥 12              │
│  Параграфов пройдено: 24                │
│  Задач решено:        156               │
│  Общий прогресс:      34%               │
│                                         │
│─────────────────────────────────────────│
│  📈 МОЙ УРОВЕНЬ                         │
│                                         │
│  Алгебра:    ████████░░ Группа B       │
│  Физика:     ██████░░░░ Группа B       │
│  История:    ████░░░░░░ Группа C       │
│                                         │
│─────────────────────────────────────────│
│  [⚙️ Настройки]  [🚪 Выйти]             │
└─────────────────────────────────────────┘
```

```bash
Задачи:
├── [ ] Страница профиля
├── [ ] Агрегация статистики по предметам
├── [ ] Визуализация mastery levels
├── [ ] Streak counter (дней подряд)
└── [ ] Настройки (язык, уведомления)
```

**Результат этапа 5:**
- Экран завершения с мотивирующим feedback
- Профиль с полной статистикой
- Визуализация прогресса по всем предметам

---

### Этап 6: Тестирование и деплой MVP (2-3 дня)

```bash
Задачи:
├── [ ] Unit тесты компонентов (Vitest)
├── [ ] E2E тесты критических flow (Playwright):
│       • Логин → Выбор предмета → Изучение параграфа
│       • Прохождение практики
│       • Просмотр результата
├── [ ] Performance audit (Lighthouse)
├── [ ] Mobile testing (реальные устройства)
├── [ ] Production deploy на ai-mentor.kz
└── [ ] Мониторинг и логирование (Sentry)
```

---

## MVP: Backend изменения

### Новые endpoints ✅ РЕАЛИЗОВАНЫ (2025-12-18)

```python
# Список учебников для студента (с прогрессом) ✅ ГОТОВ
GET /api/v1/students/textbooks
Response: [
    {
        "id": 1,
        "title": "Алгебра 7 класс",
        "subject": "Алгебра",
        "grade_level": 7,
        "is_global": true,
        "progress": {
            "chapters_total": 8,
            "chapters_completed": 2,
            "paragraphs_total": 32,
            "paragraphs_completed": 7,
            "percentage": 22
        },
        "mastery_level": "B",
        "chapters_count": 8
    }
]

# Главы учебника с прогрессом и mastery ✅ ГОТОВ
GET /api/v1/students/textbooks/{id}/chapters
Response: [
    {
        "id": 1,
        "title": "Глава 1",
        "number": 1,
        "status": "completed|in_progress|not_started|locked",
        "progress": {"paragraphs_total": 5, "paragraphs_completed": 3, "percentage": 60},
        "mastery_level": "B",
        "mastery_score": 75.5,
        "has_summative_test": true
    }
]

# Параграфы главы со статусами ✅ ГОТОВ
GET /api/v1/students/chapters/{id}/paragraphs
Response: [
    {
        "id": 1,
        "title": "§1.1 Введение",
        "number": 1,
        "status": "completed|in_progress|not_started",
        "estimated_time": 5,
        "has_practice": true,
        "practice_score": 0.85,
        "learning_objective": "...",
        "key_terms": ["термин1", "термин2"]
    }
]

# Детали параграфа с контентом ✅ ГОТОВ
GET /api/v1/students/paragraphs/{id}
Response: {
    "id": 1,
    "content": "<html>...",
    "learning_objective": "...",
    "key_terms": [...],
    "questions": [...],
    "has_audio": true,
    "has_video": false,
    "has_slides": false,
    "has_cards": true,
    "chapter_title": "...",
    "textbook_title": "..."
}

# Rich content параграфа ✅ ГОТОВ
GET /api/v1/students/paragraphs/{id}/content?language=ru
Response: {
    "paragraph_id": 1,
    "language": "ru",
    "explain_text": "...",
    "audio_url": "https://...",
    "video_url": null,
    "slides_url": null,
    "cards": [{"id": "1", "type": "term", "front": "...", "back": "..."}],
    "has_audio": true,
    "has_cards": true
}

# Навигация по параграфам ✅ ГОТОВ
GET /api/v1/students/paragraphs/{id}/navigation
Response: {
    "current_paragraph_id": 1,
    "current_paragraph_number": 1,
    "chapter_id": 1,
    "chapter_title": "...",
    "textbook_id": 1,
    "textbook_title": "...",
    "previous_paragraph_id": null,
    "next_paragraph_id": 2,
    "total_paragraphs_in_chapter": 5,
    "current_position_in_chapter": 1
}

# Прогресс по шагам ✅ РЕАЛИЗОВАН
GET /api/v1/students/paragraphs/{id}/progress
Response: {
    "paragraph_id": 1,
    "is_completed": false,
    "current_step": "content",
    "time_spent": 120,
    "embedded_questions_total": 5,
    "embedded_questions_answered": 2,
    "embedded_questions_correct": 2
}

POST /api/v1/students/paragraphs/{id}/progress
Body: {"step": "practice", "time_spent": 30}

# Самооценка ✅ РЕАЛИЗОВАН
POST /api/v1/students/paragraphs/{id}/self-assessment
Body: {"rating": "understood"}
# rating: "understood" | "questions" | "difficult"

# Встроенные вопросы ✅ РЕАЛИЗОВАН
GET /api/v1/students/paragraphs/{id}/embedded-questions
Response: [{
    "id": 1,
    "question_type": "single_choice",
    "question_text": "...",
    "options": [...],
    "hint": "...",
    "is_answered": false,
    "is_correct": null
}]

POST /api/v1/students/embedded-questions/{id}/answer
Body: {"answer": "option_id"}
Response: {"is_correct": true, "correct_answer": "...", "explanation": "..."}
```

### Изменения в существующих endpoints

```python
# Добавить в GET /students/progress
{
    "streak_days": 12,          # Дней подряд
    "total_paragraphs": 24,     # Всего пройдено
    "total_questions": 156,     # Задач решено
    "last_activity": {          # Для "Продолжить"
        "paragraph_id": 15,
        "step": "practice",
        "timestamp": "2025-12-18T10:30:00Z"
    }
}
```

---

## MVP: Итоговый timeline

| Этап | Название | Длительность | Результат |
|------|----------|--------------|-----------|
| 1 | Инфраструктура | 3-4 дня | Auth, layout, deploy |
| 2 | Навигация | 2-3 дня | Главная → Предмет → Глава |
| 3 | Изучение параграфа | 4-5 дней | Learning flow + Rich Content |
| 4 | Практика | 3-4 дня | Тесты + feedback |
| 5 | Завершение | 2-3 дня | Completion screen + профиль |
| 6 | Тестирование | 2-3 дня | E2E тесты + деплой |

**Итого MVP: ~16-22 рабочих дня**

---

## Часть 2. Post-MVP: Долгосрочное развитие

После запуска MVP — итеративное расширение функциональности на основе пользовательских данных и feedback.

### Фаза 2: Персонализация (после MVP)

**2.1 Адаптивный контент по группам A/B/C**
```
Группа A (продвинутые):
├── Более сложные задачи в практике
├── Меньше подсказок
├── Дополнительные челленджи
└── Возможность пропускать простые объяснения

Группа B (средние):
├── Стандартный путь обучения
├── Сбалансированная сложность
└── Подсказки по запросу

Группа C (начинающие):
├── Упрощённые объяснения
├── Больше примеров перед практикой
├── Автоматические подсказки
└── Разбиение на более мелкие шаги
```

**2.2 Персонализация примеров**
```
Профиль интересов ученика:
├── При онбординге: выбор интересов (спорт, музыка, игры, технологии)
├── AI генерирует примеры на основе интересов
└── Пример: "Скорость мяча после удара" вместо "Скорость автомобиля"
```

**2.3 Интеллектуальные рекомендации**
```
"Тебе может быть полезно":
├── Повторить тему X (снижение mastery)
├── Попробовать сложные задачи (стабильная группа A)
└── Пройти дополнительную практику (слабое место выявлено)
```

---

### Фаза 3: Расширенные форматы контента

**3.1 Аудио-уроки в формате диалога**
```
[AI-учитель]: Сегодня разберём линейные уравнения.
[AI-ученик]: А зачем они нужны в жизни?
[AI-учитель]: Отличный вопрос! Представь, что ты...
```
- Генерация через TTS или записанные подкасты
- Можно слушать по дороге в школу

**3.2 Интерактивные симуляции**
```
Физика: виртуальная лаборатория
├── Изменяй параметры → смотри результат
├── Графики в реальном времени
└── Проверка гипотез

Математика: графический калькулятор
├── Построение графиков функций
├── Визуализация уравнений
└── Геометрические построения
```

**3.3 Mind-maps**
```
Интерактивная карта знаний:
├── Zoom: от общего к деталям
├── Связи между понятиями
├── Цветовая кодировка по mastery
└── Навигация к любой теме
```

**3.4 Spaced Repetition (карточки)**
```
Система интервального повторения:
├── Автоматическое создание карточек из пройденного
├── Оптимальное расписание повторения
├── Интеграция с профилем
└── Геймификация (streak, очки)
```

---

### Фаза 4: RAG и AI-помощник

**4.1 Умный помощник "Спроси AI"**
```
┌─────────────────────────────────────────┐
│  💬 Спроси AI                           │
│                                         │
│  [Не понимаю, как раскрывать скобки]   │
│                                         │
│  AI: Давай разберём на примере.         │
│  Возьмём выражение 2(x + 3).           │
│  Это значит, что нужно умножить 2       │
│  на каждое слагаемое в скобках...       │
│                                         │
│  [Показать пример] [Ещё вопрос]        │
└─────────────────────────────────────────┘
```

**4.2 Контекстные пояснения**
```
При нажатии на любой термин:
├── Краткое определение
├── Связь с текущей темой
├── Примеры использования
└── Ссылки на связанные темы
```

**4.3 Анализ ошибок**
```
AI анализирует паттерны ошибок:
├── "Ты часто путаешь знаки при раскрытии скобок"
├── Предлагает целевую практику
└── Отслеживает улучшение
```

---

### Фаза 5: Социальные функции

**5.1 Групповые челленджи**
```
"Математическая неделя":
├── Класс соревнуется в решении задач
├── Leaderboard (опционально, можно скрыть)
├── Коллективные достижения
└── Награды для всего класса
```

**5.2 Peer learning (взаимопомощь)**
```
"Помоги однокласснику":
├── Группа A может объяснять группе C
├── Награды за помощь
└── Модерация учителем
```

**5.3 Достижения и бейджи**
```
Система достижений:
├── "Неделя без пропусков" 🔥
├── "Мастер алгебры" (группа A по 5 главам)
├── "Исследователь" (прошёл все доп. материалы)
└── "Помощник" (объяснил 10 тем одноклассникам)
```

---

### Фаза 6: Интеграция с учебным процессом

**6.1 Домашние задания от учителя**
```
Учитель назначает:
├── Конкретные параграфы для изучения
├── Дедлайн
├── Минимальный уровень mastery
└── Дополнительные задачи
```

**6.2 Синхронизация с расписанием**
```
"Завтра физика":
├── Напоминание повторить тему
├── Подготовка к уроку
└── Связь с календарём школы
```

**6.3 Родительский контроль**
```
Родитель видит:
├── Время на обучение
├── Прогресс по предметам
├── Сильные и слабые темы
└── НЕ видит: конкретные ответы, ошибки (privacy)
```

---

### Фаза 7: Offline и мобильное приложение

**7.1 PWA с offline-режимом**
```
Offline capabilities:
├── Кэширование пройденных материалов
├── Работа без интернета
├── Синхронизация при подключении
└── Push-уведомления
```

**7.2 Нативное мобильное приложение**
```
React Native или Flutter:
├── Лучшая производительность
├── Нативные жесты
├── Интеграция с системой (уведомления, календарь)
└── App Store / Google Play
```

---

## Roadmap: Визуализация

```
2025 Q1 (Январь-Март)
═══════════════════════════════════════════════════════════════
│                                                              │
│  MVP                                                         │
│  ├── Этап 1-2: Инфраструктура + Навигация     [Янв]         │
│  ├── Этап 3-4: Изучение + Практика            [Янв-Фев]     │
│  └── Этап 5-6: Завершение + Деплой            [Фев]         │
│                                                              │
│  Beta-тестирование с 1-2 школами              [Фев-Март]    │
│                                                              │
═══════════════════════════════════════════════════════════════

2025 Q2 (Апрель-Июнь)
═══════════════════════════════════════════════════════════════
│                                                              │
│  Фаза 2: Персонализация                                      │
│  ├── Адаптивный контент A/B/C                 [Апр]         │
│  ├── Персонализация примеров                  [Апр-Май]     │
│  └── Рекомендательная система                 [Май]         │
│                                                              │
│  Фаза 3: Расширенные форматы                                 │
│  ├── Аудио-уроки                              [Май]         │
│  ├── Spaced Repetition                        [Июнь]        │
│  └── Mind-maps                                [Июнь]        │
│                                                              │
═══════════════════════════════════════════════════════════════

2025 Q3-Q4 (Июль-Декабрь)
═══════════════════════════════════════════════════════════════
│                                                              │
│  Фаза 4: RAG и AI-помощник                    [Q3]          │
│  Фаза 5: Социальные функции                   [Q3]          │
│  Фаза 6: Интеграция с учебным процессом       [Q4]          │
│  Фаза 7: PWA + мобильное приложение           [Q4]          │
│                                                              │
═══════════════════════════════════════════════════════════════
```

---

## Метрики успеха

### MVP метрики
| Метрика | Цель | Как измерять |
|---------|------|--------------|
| Completion rate параграфа | >70% | % дошедших до конца |
| Daily Active Users | >50% от зарегистрированных | DAU / Total users |
| Session duration | 10-20 мин | Среднее время сессии |
| Return rate (D1) | >60% | % вернувшихся на след. день |
| Practice accuracy | 60-80% | % правильных ответов |
| Self-reported понимание | >75% "понятно" | Самооценка после этапов |

### Post-MVP метрики
| Метрика | Цель | Фаза |
|---------|------|------|
| Mastery improvement | +1 группа за месяц у 30% | Фаза 2 |
| AI helper usage | >40% пользуются | Фаза 4 |
| Weekly retention | >50% | Фаза 3-5 |
| NPS (Net Promoter Score) | >40 | Все фазы |
| Time to mastery | -20% от baseline | Фаза 2-4 |

---

## Риски и митигация

| Риск | Вероятность | Митигация |
|------|-------------|-----------|
| Низкий engagement | Средняя | A/B тесты форматов, быстрые итерации |
| Перегруз контентом | Средняя | Strict ограничения на длину блоков |
| Технические проблемы на mobile | Средняя | Mobile-first разработка, тестирование |
| Недостаток контента | Низкая | Приоритет на существующий Rich Content |
| Сопротивление учителей | Низкая | Обучение, показ аналитики |

---

## Команда и ресурсы

### MVP команда (минимум)
| Роль | Количество | Задачи |
|------|------------|--------|
| Frontend разработчик | 1-2 | Next.js, UI компоненты |
| Backend разработчик | 0.5 | Новые endpoints, оптимизация |
| UX/UI дизайнер | 0.5 | Макеты, user testing |
| QA | 0.5 | E2E тесты, ручное тестирование |

### Инфраструктура
- Существующий backend (api.ai-mentor.kz)
- Новый контейнер для student-app
- CDN для статики (изображения, видео)

---

## Следующие шаги

### Выполнено ✅
1. ~~Согласование плана~~ — ревью с командой
2. ~~Дизайн MVP~~ — дизайн-система Google Learn Your Way
3. ~~Инициализация проекта~~ — student-app создан и задеплоен
4. ~~Этап 1~~ — инфраструктура + авторизация (Google OAuth)
5. ~~Dashboard UI~~ — главная страница с mock данными

### Выполнено ✅ (2025-12-18)
6. **Backend endpoints для Этапа 2** — все 6 endpoints реализованы:
   - ✅ GET /students/textbooks (с прогрессом)
   - ✅ GET /students/textbooks/{id}/chapters (с mastery)
   - ✅ GET /students/chapters/{id}/paragraphs (со статусами)
   - ✅ GET /students/paragraphs/{id} (детали)
   - ✅ GET /students/paragraphs/{id}/content (rich content)
   - ✅ GET /students/paragraphs/{id}/navigation (prev/next)

7. **Frontend интеграция Этапа 2** — полностью завершено:
   - ✅ TanStack Query Provider + API клиенты
   - ✅ Хуки: useTextbooks, useTextbookChapters, useChapterParagraphs, etc.
   - ✅ Dashboard с реальными данными из API
   - ✅ Страница учебника `/subjects/[id]` со списком глав
   - ✅ Страница главы `/chapters/[id]` со списком параграфов
   - ✅ Локализация ru/kk для всех новых страниц

### Выполнено ✅ (2025-12-18, продолжение)
8. **Этап 3** — изучение параграфа (Learning Flow):
   - ✅ Страница параграфа `/paragraphs/[id]`
   - ✅ Отображение контента (explain_text)
   - ✅ Rich content (аудио, видео, карточки)
   - ✅ Навигация prev/next
   - ✅ StepIndicator (intro → content → practice → summary → completed)
   - ✅ Локализация ru/kk

9. **Этап 4** — практика и embedded questions:
   - ✅ Компонент EmbeddedQuestion (single/multiple choice, true/false)
   - ✅ Компонент SelfAssessment (understood/questions/difficult)
   - ✅ Backend API: progress, self-assessment, embedded questions
   - ✅ Миграция: `embedded_questions`, `student_embedded_answers`
   - ✅ Деплой на production (ai-mentor.kz)

### Следующий приоритет 📋
10. **Этап 5** — экраны завершения и профиль
11. **Этап 6** — E2E тесты

---

## История изменений

| Версия | Дата | Изменения |
|--------|------|-----------|
| 1.0 | 2025-12-18 | Начальный план MVP |
| 1.1 | 2025-12-18 | Добавлена дизайн-система, отмечены выполненные этапы |
| 1.2 | 2025-12-18 | Backend endpoints для Этапа 2 реализованы (6 endpoints) |
| 1.3 | 2025-12-18 | **Этап 2 полностью завершён:** Dashboard + страницы учебника и главы |
| 1.4 | 2025-12-18 | **Этапы 3-4 полностью завершены:** Learning Flow, StepIndicator, EmbeddedQuestion, SelfAssessment, деплой на production |

---

*Документ создан: 2025-12-18*
*Последнее обновление: 2025-12-18*
*Автор: Claude Code*
